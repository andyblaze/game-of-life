<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wireworld Demo</title>
<style>
    body {
        background: #111;
        margin: 0;
        overflow: hidden;
        font-family: sans-serif;
        color: #ddd;
    }
    #info {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.5);
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
    }
    canvas {
        display: block;
    }
</style>
</head>
<body>

<div id="info">Wireworld — running (space to pause, +/- to change speed)</div>
<canvas id="c"></canvas>

<script>
// ------------------------------------------------------------
// Wireworld implementation
// ------------------------------------------------------------

// States
const EMPTY = 0;
const WIRE = 1;
const HEAD = 2;
const TAIL = 3;

// Colors
const COLORS = {
    [EMPTY]: "#111",
    [WIRE]: "#c9a40a",
    [HEAD]: "#3aa9ff",
    [TAIL]: "#ff3e3e"
};

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let W = 100;     // grid width
let H = 60;      // grid height
let cellSize = 12;

canvas.width = W * cellSize;
canvas.height = H * cellSize;

// Create grid
let grid = [];
let next = [];

function makeGrid() {
    grid = new Array(H).fill(0).map(()=>new Array(W).fill(0));
    next = new Array(H).fill(0).map(()=>new Array(W).fill(0));
}
makeGrid();

// ------------------------------------------------------------
// Example pattern — “Loop + Pulse Splitter + Clock”
// ------------------------------------------------------------
function loadDemo() {
    // A looping ring
    for (let x = 10; x < 40; x++) grid[20][x] = WIRE;
    for (let x = 10; x < 40; x++) grid[30][x] = WIRE;
    for (let y = 20; y < 31; y++) grid[y][10] = WIRE;
    for (let y = 20; y < 31; y++) grid[y][39] = WIRE;

    // Initial electron to start the loop
    grid[20][15] = HEAD;

    // Pulse splitter
    // A "T" junction that will create two pulses
    let sx = 60, sy = 25;
    grid[sy][sx] = WIRE;
    grid[sy][sx+1] = WIRE;
    grid[sy][sx-1] = WIRE;
    grid[sy-1][sx] = WIRE;
    grid[sy+1][sx] = WIRE;

    // Wire paths leading out
    for (let i=1;i<10;i++) {
        grid[sy-1][sx+i] = WIRE;
        grid[sy+1][sx+i] = WIRE;
    }

    // Trigger pulse toward splitter
    grid[sy][sx-2] = HEAD;

    // Output loops at ends
    for (let i=0;i<20;i++) {
        grid[sy-1][sx+9+i] = WIRE;
        grid[sy+1][sx+9+i] = WIRE;
    }
}
loadDemo();

// ------------------------------------------------------------
// Simulation
// ------------------------------------------------------------

function countNeighborHeads(y, x) {
    let count = 0;
    for (let dy = -1; dy <= 1; dy++) {
        for (let dx = -1; dx <= 1; dx++) {
            if (dx === 0 && dy === 0) continue;
            let yy = y + dy;
            let xx = x + dx;
            if (yy >= 0 && yy < H && xx >= 0 && xx < W) {
                if (grid[yy][xx] === HEAD) count++;
            }
        }
    }
    return count;
}

function step() {
    for (let y = 0; y < H; y++) {
        for (let x = 0; x < W; x++) {
            let s = grid[y][x];
            if (s === EMPTY) next[y][x] = EMPTY;
            else if (s === HEAD) next[y][x] = TAIL;
            else if (s === TAIL) next[y][x] = WIRE;
            else if (s === WIRE) {
                let n = countNeighborHeads(y, x);
                next[y][x] = (n === 1 || n === 2) ? HEAD : WIRE;
            }
        }
    }

    // swap
    let tmp = grid;
    grid = next;
    next = tmp;
}

function draw() {
    for (let y = 0; y < H; y++) {
        for (let x = 0; x < W; x++) {
            ctx.fillStyle = COLORS[grid[y][x]];
            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
        }
    }
}

// ------------------------------------------------------------
// Main loop
// ------------------------------------------------------------
let running = true;
let speed = 80; // ms per step

function loop() {
    if (running) step();
    draw();
    setTimeout(loop, speed);
}
loop();

// Controls
window.addEventListener("keydown", e => {
    if (e.key === " ") running = !running;
    if (e.key === "+" || e.key === "=") speed = Math.max(5, speed - 5);
    if (e.key === "-") speed += 5;
});

</script>
</body>
</html>
