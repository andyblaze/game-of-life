<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Procedural City</title>
<style>
    body { margin:0; overflow:hidden; background:#111; }
    canvas { display:block; }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

// -------------------- CITY PARAMETERS --------------------
const CELL_SIZE = 40;       // width of a block
const ROWS = Math.floor(H / CELL_SIZE);
const COLS = Math.floor(W / CELL_SIZE);
const BUILDING_MAX_HEIGHT = 30; // for visual scale
const LIGHT_PROB = 0.5;     // probability a window is lit
const NUM_CARS = 30;

// -------------------- CITY GRID --------------------
let city = [];
for(let i=0;i<ROWS;i++){
    let row = [];
    for(let j=0;j<COLS;j++){
        // Random building height
        let h = Math.random() < 0.7 ? Math.random()*BUILDING_MAX_HEIGHT : 0;
        row.push({height:h, lights:[]});
        if(h>0){
            let windows = Math.floor(h/3);
            let lights = [];
            for(let w=0; w<windows; w++){
                lights.push(Math.random()<LIGHT_PROB);
            }
            row[j].lights = lights;
        }
    }
    city.push(row);
}

// -------------------- CARS --------------------
class Car{
    constructor(){
        this.row = Math.floor(Math.random()*ROWS);
        this.col = 0;
        this.speed = 0.5 + Math.random();
        this.dir = 1; // left to right
    }
    update(){
        this.col += this.speed * this.dir;
        if(this.col>COLS) this.col = 0;
    }
    draw(){
        ctx.fillStyle = "#ff4444";
        ctx.fillRect(this.col*CELL_SIZE + CELL_SIZE*0.2, this.row*CELL_SIZE + CELL_SIZE*0.7, CELL_SIZE*0.6, CELL_SIZE*0.2);
    }
}

let cars = [];
for(let i=0;i<NUM_CARS;i++) cars.push(new Car());

// -------------------- ANIMATION --------------------
let time = 0;

function loop(){
    time += 0.01;

    // Background
    ctx.fillStyle = "#111";
    ctx.fillRect(0,0,W,H);

    // -------------------- BUILDINGS --------------------
    for(let i=0;i<ROWS;i++){
        for(let j=0;j<COLS;j++){
            let cell = city[i][j];
            if(cell.height>0){
                // Parallax effect: distant buildings darker
                let brightness = 50 + (cell.height/BUILDING_MAX_HEIGHT)*150;
                ctx.fillStyle = `rgb(${brightness},${brightness},${brightness})`;
                ctx.fillRect(j*CELL_SIZE, i*CELL_SIZE, CELL_SIZE-1, CELL_SIZE-1);

                // Draw windows
                let numWindows = cell.lights.length;
                for(let w=0; w<numWindows; w++){
                    if(cell.lights[w]){
                        ctx.fillStyle = "#ffcc33";
                        let wx = j*CELL_SIZE + CELL_SIZE*0.2;
                        let wy = i*CELL_SIZE + CELL_SIZE*0.2 + w*3;
                        ctx.fillRect(wx, wy, CELL_SIZE*0.6, 2);
                    }
                }
            }
        }
    }

    // -------------------- CARS --------------------
    for(let car of cars){
        car.update();
        car.draw();
    }

    // -------------------- NIGHT LIGHT FLICKER --------------------
    if(Math.random()<0.05){
        for(let i=0;i<ROWS;i++){
            for(let j=0;j<COLS;j++){
                let cell = city[i][j];
                if(cell.height>0){
                    cell.lights = cell.lights.map(l => Math.random()<LIGHT_PROB);
                }
            }
        }
    }

    requestAnimationFrame(loop);
}
loop();

// -------------------- RESIZE --------------------
window.addEventListener('resize', ()=>{
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
});
</script>
</body>
</html>
